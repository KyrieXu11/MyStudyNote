# Mysql有哪些索引结构

hash 和 b+ 

# 为什么hash表、二叉树、AVL树、b-、b+都可以优化查询，mysql选择了b+树

## 为什么需要索引

mysql底层使用的时B+树，mysql索引是放在磁盘上面的，因此每次读取索引时通过IO从磁盘读取。引入索引的目的就是为了减少IO次数，避免慢查询。

## hash

字段值所对应的数组的下标是通过hash算法算出来的，所以，hash表能解决等值查询，如果是范围查询的话，那么就不行了。

![hash_gif_01.gif](https://i.loli.net/2020/03/04/qrcMYCO2Hik6vjE.gif)

通过hash算法，讲字符串转换成对应的数组下标，如果有重复的hash值，就和链表一样，在对应的下标插入一个节点。

所以hash的最理想的使用场景就是等值查询

```sql
select * from table where id = 123;
```

这样的查询走hash索引结构的话，查询会加快。但是如果是范围查询如：

```sql
select * from table where id > 123;
```

hash索引就会显得无能为力了。

## 二叉查找树

![bst_gif_01.gif](https://i.loli.net/2020/03/04/DozpefEA51Y2XJW.gif)

解决hash索引不能排序问题，但是当数据有序时会出现线性排列，树的深度会变得很深，会消耗大量IO。

## AVL树

下面这个是一颗普通的二叉查找树，可以看出来，这样的树，树高很高，而树高的后果，上面也说了，是会导致IO次数增多。

![bst.png](https://i.loli.net/2020/03/05/eaFYSTJ9E4RnOjC.png)

而Avl树就比普通的二叉查找树的树高要低，可以看一下：

![avlt.png](https://i.loli.net/2020/03/05/lRnwLedDc3zfG5s.png)

同样的数据，avl树的树高就比上面的普通的二叉查找树要少的多，“矮胖”的树才能减少IO次数，那么为什么Avl树也不行呢？上面的avl树，在数据量少的时候，看起来还挺好的，但是在数据库里面吧，数据量很大的情况下，树高还是会非常高，而且不仅仅是这个原因，Avl树每个节点只保存了一个**关键字**的长度(如i**nt类型 4byte**)，而在从磁盘读取数据的时候以**一页(4kb**)为单位来进行读取的，所以白白的浪费了4kb-4b=**4092b**的空间。

## B-树

解决平衡二叉树树深度的问题，解决了平衡二叉树读取消耗大量内存空间的问题。

因为B-树每个节点可以存放多个关键字，最大限度的利用了从磁盘读取的内存空间，单节点存放多个关键字同时也大大减少了树的深度。极大的提高了mysql的查询性能。下面就是一个b-树，同样的数据，b-树比上面的avl树的树高还要低。就是因为一**个节点可以存储多个数据**，从而少了一些磁盘IO的浪费

![bt.png](https://i.loli.net/2020/03/05/svxACrDLTWenERJ.png)

B-树还有一个特点，那就是为了解决上面的IO浪费的问题，每次新建节点时，**直接申请一个页的空间**，这样就保证一个节点物理上也存储在一个页里，加之计算机存储分配都是按页对齐的，就实现了一个node**只需一次I/O**。

但是B-树还是有缺点，B-树对有**范围查找的查询**（如age>20）时采用的还是**中序遍历**，因此也需要多遍历，并且查询性能不稳定。

比如查询（select * from table where id = 222 和 select * from table where id = 223）时在查询效率（耗时）上可能会存在一定的差别，因为B-树还是将关键字，这里为id，存放在根节点和叶节点的，如果运气好，可能id=222这个关键字就在第一个节点，消耗一次IO就找到了，而id=223可能在叶子节点，需要消耗3次IO才能找到。因此B-树对同一条sql语句的查询性能可能会有很大影响。

B树的优势是当你要查找的值恰好处在一个非叶子节点时，查找到该节点就会成功并结束查询，如果在非叶子节点的情况下，那就会一直查询。

总结一下：b-树对同一条sql语句的查询的影响会有很大的不同

## B+树

B+树：将关键字全部存放在叶子节点(查询更稳定，同一条mysql语句执行效率时相同的，都会消耗3次IO)，将相邻叶子节点的地址保存起来（相比于B-树，对于mysql的范围查找不用再使用中序查找，而是可以直接快读获取到。）下面就是一个b+树，之后叶子节点保存数据，其他的节点都是索引，而且B+树的IO次数稳定是很稳定的。

B-树/B+树 的特点就是每层节点数目非常多，层数很少，目的就是为了就少磁盘IO次数。

![bplus.png](https://i.loli.net/2020/03/05/dop25tuPSeRLvlK.png)

总结：mysql最终使用B+树为mysql索引的底层实现，mysql维护索引有很大的消耗的，会极大的影响数据库的增、改、删操作，因此建立有用的索引很重要，索引字段所占字节越少，mysql一次读取的关键字也会也多，消耗IO会更少、命中率会更大，查询效率随之也会更高。

而且相对于B-树来说，B+树支持范围查询，更加快捷，所以Mysql选择了B+树